## 分布式计算谬误

1. 网络延迟问题
   1. 消息丢失
   2. 超时导致重传和误判不在线
   3. 乱序
2. 带宽
3. 网络安全
4. 拓扑结构改变
5. 单一管理员
6. 传输成本
7. 网络是同构的
8. 部分失效
9. 时钟问题
   1. 每台机器的时钟不同
   2. 网络传输存在时延

## 两将军问题

两个将军需要同时进攻一处堡垒，但由于派出的信使可能被俘，所以都无法确信对方是否收到消息，导致即使重复发出确认的消息，仍然无法保证消息可靠

该问题表明节点之间只能通过消息传递来确认彼此的状态

工程解：TCP 的三次握手

## 拜占庭将军问题

两将军问题的延申，多个将军协商进攻/撤退，但可能存在叛徒故意散布假消息(发送矛盾的消息)，该问题的主要目的是令忠诚的将领在同一个计划达成共识

## 网络链路模型

网络设备出现故障，但节点仍正常工作，导致节点之间无法通信，形成网络分区

链路：

- 可靠链路：不会丢失，不会凭空生成消息，可能乱序
- 公平损失链路：可能丢失，可以通过重发升级为可靠链路
- 任意链路：可能丢失，也可能被攻击者篡改、伪造数据，通过 TLS 等手段升级为公平损失链路

## 节点故障模型

节点可能在发送/接收消息时出现故障，导致消息丢失

节点故障类型：

- 崩溃-停止：节点发生硬件上的故障导致崩溃，一般来说进程失败后就永久退出运行状态，不再加入系统
- 崩溃-恢复：节点故障后可以通过重启等手段恢复并重新加入系统，通常需要日志、检查点等持久化存储进行恢复
- 拜占庭问题：节点故障后可能会令算法偏移甚至故意破坏算法

## 时分模型

根据消息的响应时间分为同步/异步模型

- 同步：消息在一段可预知的时间内响应，简单但不可靠，因为节点和网络可能出现故障
- 异步：无法预知消息何时响应，基于异步的算法更加健壮，且适用于同步场景，但存在 FLP 不可能问题
- 部分同步

## 消息传递语义

由于网络/节点可能存在故障，导致消息丢失，故需要进行重发，但重发的多个消息可能被执行多次，虽然可以通过幂等操作令其只生效一次，但需要一直等待确认请求来保证每个操作都是幂等的，开销较大

通过消息的唯一标识来避免多次执行：

- At Most Once：消息严格传递一次，即使丢失也不重发
- At Least Once：消息至少发送一次，丢失后会重发
- Exactly Once：消息精确发送一次，不会丢失，也不会重发，不现实，通过忽略重发来达到该效果

# 分布式数据