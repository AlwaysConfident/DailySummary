## 地基视频管理平台

为了便于查看工地各个桩的执行情况，需要搭建视频管理平台，对接各个摄像头与执法记录仪，支持在网页端对设备与视频进行操作

通过修改 wvp 源代码，实现设备在线时自动创建拉流代理并开始拉流

### 核心技术

- ffmpeg + zlm + wvp：
  - ffmpeg：负责视频流的采集、转码与推流。例如从摄像头拉取RTSP流并转换为适合网络传输的格式（如H.264/H.265），通过推流协议（如RTMP、HTTP-FLV）发送到流媒体服务器
  - zlm：作为高性能流媒体服务器，承担接收、转发、转码和分发视频流的任务。支持多种协议（RTSP/RTMP/HTTP-FLV/HLS），并可将流分发给客户端或其他服务器
  - wvp：作为视频管理平台，提供设备接入管理、流媒体调度、用户权限控制及前端展示功能。通过GB/T 28181协议或其他标准对接摄像头，并调用ZLM的API实现流的分发与播放
- docker：将 zlm 与 wvp 项目打包成 docker 镜像文件并部署至阿里云 k8s 服务器上
- 通过将阿里云 nas 与 zlm 容器挂载，实现将视频文件存储至 nas 中，并且设置生命周期策略，令 15 天内未被访问的视频文件转为冷存储

### 工作流程

wvp 将设备通过 GB28181 协议接入平台、生成设备与通道编号并将设备信息发送至 zlm

zlm 结合设备信息通过 ffmpeg 从摄像头拉取原始视频流并根据需求进行转码

ffmpeg 将处理后的流通过 rtmp 协议推送至 zlm 服务器，zlm 生成唯一的流地址返回给 wvp

## 建科官网与管理后台

将旧官网项目进行国产化并且在保证原有功能的基础上进行优化升级

### 核心技术

- thymeleaf：使用 thymeleaf 实现前台静态页面与动态搜索页的模板化生成
- openGauss：在保留原始数据的情况下，将原本的 SQL Server 数据库移植到国产的 openGauss 中，并将 SQL 语句改造成类 PostgreSQL 的形式
- 线程池：使用 CompletableFuture + ExecutorService 线程池实现页面的异步多线程生成，提高页面生成效率
-  普元服务器：将服务部署至普元的 openEuler 服务器，并且使用其类 Nginx 进行负载均衡配置
-  ftp：使用 vsftpd 部署 ftp 服务器存储静态文件

### 工作内容

- 将 .net form 框架移植到 spring boot + thymeleaf
  - 由于国产化需要，项目需要部署至 arm64 架构的 openEuler 服务器上，而 .net form 与更新的 .net framework 仅能部署至 Windows 系统， .net core 框架虽然适用于多平台，但也存在许多兼容性问题，出于工期与学习成本的考虑，决定将项目移植到更为熟悉的 spring boot 框架
- 使用 vsftpd 部署 ftp 服务器存储静态文件

## 珠海监测

这个项目由珠海市政府委托，珠海住建局出资，用于对接五方单位与市监督平台，实现原始监测数据的收集、分析与报警等功能

### 核心技术

- SaaS 架构：系统分为企业端与平台端
  - 平台端：负责管理所有的企业端信息，包括企业端的租户、项目、报警、巡查管理，平台端批准企业端申请后自动运行 sql 脚本，创建相关数据库、添加 nginx 配置、发送提示短信
  - 企业端：各五方单位申请后在此管理项目、测点数据
- 自动化设备端：为了让测点数据不落地，使用 socket server 创建 socket 服务器，循环监听 socket 连接，在建立连接后收集并处理自动化设备传输的数据，并将解析后的数据发送到 rabbitMq
  - 不落地：数据从设备直传到平台，不需要产生中间文件之后再上传，避免数据被修改
  - 数据发送到 redis 后的处理：使用定时任务处理

### 工作内容

- 搭建客户端与平台端之间的工作流程：
  - 客户端需要向平台端发起审批流程，如消警、巡查审批
  - 平台端需要从客户端中获取项目、报警、监测信息等
  - 两者间通信使用 Http？Feign？RPC 框架？
- 客户端的数据源切换：
  - ThreadLocal 保存当前数据源上下文
  - 基于 AbstractRoutingDataSource 实现数据源切换
  - 平台端使用 header 中的 tenant id 来表示需要获取的企业端信息
- 搭建审批流：
  - 审批流由三种元素组成：
    - 节点：节点信息表示当前处于审批流的哪个状态，例如发起、审批、验收、结束，一个完整的审批流会有多个节点
    - 申请信息：记录提交申请时的申请人、申请类型、表单数据，以及当前所处的状态、审批人、节点、历史驳回人，下一步的审批人
    - 审批信息：记录一次审批的信息，包括对应的申请表、审批表单数据(备注、图片等)、审批人
  - 申请人在提交申请表单时会选择申请类型，从而创建对应节点的申请信息，并交付给下一个审批人的待办列表中
  - 审批人可以选择同意或驳回，同意则再交付至下一个审批人直到结束(添加结束节点)，驳回则转回给发起人

## 结构监测系统

与传感器厂商对接，负责接收、分析、管理传感器数据

### 核心技术

- 处理 20条/s 的数据存储场景
  - 要求所有数据不能丢失
  - 数据访问频率极低，一般只会查看出现问题的数据(变化激增)