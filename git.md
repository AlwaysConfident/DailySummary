# Git

用于进行版本控制的代码仓库

## 版本控制

- 无版本控制：出现问题后无法立即回溯到之前的可用版本，且难以快速定位问题所在与负责人
- 本地版本控制：通过手动备份项目目录，重命名添加时间戳的方式在本地系统进行版本控制
  - 人为操作容易出现失误(放错目录、覆盖文件)
  - 在多人开发的场景难以同步代码
- 集中化的版本控制：通过单一的集中管理服务器保存所有代码版本，由客户端连接服务器获取/提交最新的文件，满足多个开发者协同工作
  - 单点故障
  - 受限于网络，即使只用于本地代码版本管理也需要联网
- 分布式版本控制：客户端不只提取最新的文件快照，而是把代码仓库完整地镜像下载，此时客户端也可以看作是一个服务器，当服务器故障时，可以通过任一镜像的本地仓库恢复
  - 无需联网，客户端将代码仓库镜像下载后拥有完整的版本库，可以在本地进行代码版本管理，在需要提交修改时推送给别人
- Git：本质上也是一种分布式版本控制，但在此基础上进行优化
  - 快照代替增量：
    - 差异比较：大部分版本控制系统通过记录增量的方式存储版本信息，将保存的信息看作一组文件和每个文件随时间逐步累积的差异。
      - 提交更新文件后，系统会记录文件做出的更新，以增量符号标记，获取文件时再将增量逐步相加得到最新文件
      - 当文件迭代版本过多，增量过大时，获取新文件的开销较大
    - 文件快照：Git 将数据看作对小型文件系统的一组快照，每次提交更新都会保存当前全部文件的快照并保存快照索引

## Git 状态

- 已修改(modified)：文件被修改，但未持久化到本地数据库，存储于工作空间(working directory)
- 已暂存(staged)：标记已修改文件，包含在下次提交时的快照中，存储于暂存空间(staging area)
- 已提交(committed)：修改已提交至本地数据库中，存储于本地代码仓库(.git directory)

工作流程：modified → staged → committed

## 分支

用于隔离开发，各分支间相互独立

切换分支时，Git 会重置工作目录，通过自动添加、删除、修改文件以确保此时工作目录最后一次提交时一致

## 并发冲突

每次提交到远程仓库前需要先拉取最新的代码，由人工进行冲突合并

基于 MVCC 实现并发冲突处理：

当两个提交操作 A, B 并发执行时，会先合并其中一个 A，再将 B 的提交进行冲突检测